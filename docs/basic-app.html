<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1 Your first Shiny app | Mastering Shiny</title>
<meta name="author" content="Hadley Wickham">
<meta name="generator" content="bookdown 0.34.2 with bs4_book()">
<meta property="og:title" content="Chapter 1 Your first Shiny app | Mastering Shiny">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 1 Your first Shiny app | Mastering Shiny">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.0/transition.js"></script><script src="libs/bs3compat-0.5.0/tabs.js"></script><script src="libs/bs3compat-0.5.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141197094-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-141197094-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="1.1 Introduction 在本章中，我们将创建一个简单的 Shiny app。 我将首先向您展示 Shiny app 所需的最小样板，然后您将学习如何启动和停止它。 接下来，您将学习每个 Shiny app 的两个关键组件：定义 app 外观的 UI（user interface 的缩写），和定义 app 工作方式的 server function。 Shiny...">
<meta property="og:description" content="1.1 Introduction 在本章中，我们将创建一个简单的 Shiny app。 我将首先向您展示 Shiny app 所需的最小样板，然后您将学习如何启动和停止它。 接下来，您将学习每个 Shiny app 的两个关键组件：定义 app 外观的 UI（user interface 的缩写），和定义 app 工作方式的 server function。 Shiny...">
<meta name="twitter:description" content="1.1 Introduction 在本章中，我们将创建一个简单的 Shiny app。 我将首先向您展示 Shiny app 所需的最小样板，然后您将学习如何启动和停止它。 接下来，您将学习每个 Shiny app 的两个关键组件：定义 app 外观的 UI（user interface 的缩写），和定义 app 工作方式的 server function。 Shiny...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Mastering Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="basic-intro.html">Introduction</a></li>
<li><a class="active" href="basic-app.html"><span class="header-section-number">1</span> Your first Shiny app</a></li>
<li><a class="" href="basic-ui.html"><span class="header-section-number">2</span> Basic UI</a></li>
<li><a class="" href="basic-reactivity.html"><span class="header-section-number">3</span> Basic reactivity</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/zhenghu159/blogdown-book-zh-cn">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="basic-app" class="section level1" number="1">
<h1>
<span class="header-section-number">1</span> Your first Shiny app<a class="anchor" aria-label="anchor" href="#basic-app"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction" class="section level2" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>在本章中，我们将创建一个简单的 Shiny app。
我将首先向您展示 Shiny app 所需的最小样板，然后您将学习如何启动和停止它。
接下来，您将学习每个 Shiny app 的两个关键组件：定义 app 外观的 <strong>UI</strong>（user interface 的缩写），和定义 app 工作方式的 <strong>server function</strong>。
Shiny 使用<strong>响应式编程（reactive programming）</strong>在输入变化时自动更新输出，因此我们将通过学习 Shiny app 的第三个重要组件来结束本章：<strong>响应式表达式（reactive expressions）</strong>。</p>
<p>如果您尚未安装 Shiny，请立即安装：</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"shiny"</span><span class="op">)</span></span></code></pre></div>
<p>如果您已经安装了 Shiny，请使用 <code>packageVersion("shiny")</code> 检查您是否拥有 1.5.0 或更高版本。</p>
<p>然后加载当前的 R 会话：</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="create-app" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> Create app directory and file<a class="anchor" aria-label="anchor" href="#create-app"><i class="fas fa-link"></i></a>
</h2>
<p>有多种方法可以创建 Shiny app。
最简单的方法是为您的 app 创建一个新目录，并在其中放置一个名为 <code>app.R</code> 的文件。
这个 <code>app.R</code> 文件将用于告诉 Shiny 您的 app 应该如何显示以及它应该如何运行。</p>
<p>通过创建一个新目录并添加一个如下所示的 <code>app.R</code> 文件来尝试一下：</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="st">"Hello, world!"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>这是一个完整但微不足道的 Shiny app！
仔细观察上面的代码，我们的 <code>app.R</code> 做了四件事：</p>
<ol style="list-style-type: decimal">
<li><p>它调用 <code><a href="https://shiny.rstudio.com/">library(shiny)</a></code> 来加载 shiny 包。</p></li>
<li><p>它定义了用户界面，即人类与之交互的 HTML 网页。
在本例中，它是一个包含 “Hello, world!” 字样的页面。</p></li>
<li><p>它通过定义 <code>server</code> 函数来指定我们 app 的行为。
它目前是空的，所以我们的应用程序不执行任何操作，但我们很快就会回来重新讨论这个问题。</p></li>
<li><p>它执行 <code>shinyApp(ui, server)</code> 来从 UI 和 server 构建并启动 Shiny app。</p></li>
</ol>
<div class="rmdnote">
<p><strong>RStudio Tip</strong>: 在 RStudio 中创建一个新的 app 有两种便捷的方法：</p>
<ul>
<li><p>单击 <strong>File | New Project</strong> 创建一个新目录和一个包含基本 app 的 <code>app.R</code> 文件，然后选择 <strong>New Directory</strong> 和 <strong>Shiny Web Application</strong>。</p></li>
<li><p>如果您已经创建了 <code>app.R</code> 文件，则可以通过键入 “shinyapp” 并按 Shift+Tab 快速添加 app 样板。</p></li>
</ul>
</div>
</div>
<div id="running" class="section level2" number="1.3">
<h2>
<span class="header-section-number">1.3</span> Running and stopping<a class="anchor" aria-label="anchor" href="#running"><i class="fas fa-link"></i></a>
</h2>
<p>您可以通过以下几种方式运行此 app：</p>
<ul>
<li><p>单击文档工具栏中的 <strong>Run App</strong> (Figure <a href="basic-app.html#fig:run-app">1.1</a>) 按钮。</p></li>
<li><p>使用键盘快捷键：<code>Cmd/Ctrl</code> + <code>Shift</code> + <code>Enter</code>。</p></li>
<li><p>如果您不使用 RStudio，您可以 <code>(source())</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;外面额外的 &lt;code&gt;()&lt;/code&gt; 很重要。
&lt;code&gt;shinyApp()&lt;/code&gt; 仅在打印时创建一个应用程序，而 &lt;code&gt;()&lt;/code&gt; 强制打印源文件中的最后结果，否则将以不可见的方式返回。&lt;/p&gt;"><sup>1</sup></a> 整个文档，或者使用包含 <code>app.R</code> 的目录的路径调用 <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">shiny::runApp()</a></code>。</p></li>
</ul>
<div class="figure">
<span style="display:block;" id="fig:run-app"></span>
<img src="images/basic-app/run-app.png" alt="Run App 按钮位于源窗格的右上角。" width="617"><p class="caption">
Figure 1.1: Run App 按钮位于源窗格的右上角。
</p>
</div>
<p>选择这些选项之一，并检查您是否看到与 Figure <a href="basic-app.html#fig:hello-world">1.2</a> 中相同的 app。
恭喜！
您已经制作了第一个 Shiny app。</p>
<div class="figure">
<span style="display:block;" id="fig:hello-world"></span>
<img src="images/basic-app/hello-world.png" alt="当您运行上面的代码时，您将看到一个非常基本的 shiny app" width="440"><p class="caption">
Figure 1.2: 当您运行上面的代码时，您将看到一个非常基本的 shiny app
</p>
</div>
<p>在关闭 app 之前，请返回 RStudio 并查看 R console。
你会注意到它说的是这样的：</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&gt; Listening on http://127.0.0.1:3827</span></span></code></pre></div>
<p>这告诉您可以找到您的 app 的 URL：127.0.0.1 是一个标准地址，表示“这台计算机”，3827 是一个随机分配的端口号（port）。
您可以在任何兼容的<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Shiny 致力于支持所有现代浏览器，您可以在 &lt;a href="https://www.rstudio.com/about/platform-support/" class="uri"&gt;https://www.rstudio.com/about/platform-support/&lt;/a&gt; 上查看当前支持的浏览器集。
请注意，直接从 R 会话运行 Shiny 时，IE11 之前的 Internet Explorer 版本不兼容。
但是，部署在 Shiny Server 或 ShinyApps.io 上的 Shiny apps 可以与 IE10 一起使用（不再支持早期版本的 IE）。&lt;/p&gt;'><sup>2</sup></a>网络浏览器中输入该 URL 以打开你的 app 的另一个副本。</p>
<p>另请注意 R 正忙：R 提示不可见，并且控制台工具栏显示停止标志图标。
当 Shiny app 运行时，它会“阻止” R console。
这意味着在 Shiny app 停止之前，您无法在 R console 上运行新命令。</p>
<p>您可以使用以下任一选项停止 app 并返回对 console 的访问权限：</p>
<ul>
<li><p>单击 R console 工具栏上的停止标志图标。</p></li>
<li><p>单击 console，然后按 <code>Esc</code>（如果您不使用 RStudio，则按 <code>Ctrl</code> + <code>C</code>）。</p></li>
<li><p>关闭 Shiny app 窗口。</p></li>
</ul>
<p>Shiny app 开发的基本工作流程是编写一些代码，启动 app，使用 app，编写更多代码，然后重复。
如果您使用的是 RStudio，您甚至不需要停止并重新启动应用程序即可查看更改 — 您可以按工具箱中的 <strong>Reload app</strong> 按钮或使用 <code>Cmd/Ctrl</code> + <code>Shift</code> + <code>Enter</code> 键盘快捷键。
我将在 Chapter <a href="#action-workflow"><strong>??</strong></a> 中介绍其他工作流程模式。</p>
</div>
<div id="adding-ui" class="section level2" number="1.4">
<h2>
<span class="header-section-number">1.4</span> Adding UI controls<a class="anchor" aria-label="anchor" href="#adding-ui"><i class="fas fa-link"></i></a>
</h2>
<p>接下来，我们将向 UI 添加一些输入和输出，这样它就不会那么小了。
我们将制作一个非常简单的 app，向您显示 datasets 包中包含的所有内置 data frames。</p>
<p>将您的 <code>ui</code> 替换为以下代码：</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span><span class="st">"dataset"</span>, label <span class="op">=</span> <span class="st">"Dataset"</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="st">"package:datasets"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"summary"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>此示例使用四个新函数：</p>
<ul>
<li><p><code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage()</a></code> 是一个 <strong>layout function</strong>，用于设置页面的基本视觉结构。
您将在 Section <a href="#layout"><strong>??</strong></a> 中了解有关它们的更多信息。</p></li>
<li><p><code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code> 是一个 <strong>input control</strong>，允许用户通过提供值（value）与 app 交互。
在本例中，它是一个带有 “Dataset” 标签的选择框，可让您选择 R 附带的内置数据集之一。
您将在 Section <a href="basic-ui.html#inputs">2.2</a> 中了解有关输入的更多信息。</p></li>
<li><p><code><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput()</a></code> 和 <code><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput()</a></code> 是 <strong>output controls</strong>，它们告诉 Shiny 将渲染的输出放在哪里（我们稍后会介绍如何放置）。
<code><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput()</a></code> 显示代码，<code><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput()</a></code> 显示表格。
您将在 Section <a href="basic-ui.html#outputs">2.3</a> 中了解有关输出的更多信息。</p></li>
</ul>
<p>布局函数、输入和输出有不同的用途，但它们本质上是相同的：它们都是生成 HTML 的奇特方法，如果您在 Shiny app 之外调用其中任何一个，您将看到 HTML 在控制台打印出来。
不要害怕四处探索，看看这些不同的布局和控件在幕后是如何工作的。</p>
<p>继续并再次运行该 app。
现在您将看到 Figure <a href="basic-app.html#fig:basic-ui">1.3</a>，这是一个包含选择框的页面。
我们只看到输入，看不到两个输出，因为我们还没有告诉 Shiny 输入和输出是如何关联的。</p>
<div class="figure">
<span style="display:block;" id="fig:basic-ui"></span>
<img src="demos/basic-app/ui.png" alt="The datasets app with UI" width="600"><p class="caption">
Figure 1.3: The datasets app with UI
</p>
</div>
</div>
<div id="server-function" class="section level2" number="1.5">
<h2>
<span class="header-section-number">1.5</span> Adding behaviour<a class="anchor" aria-label="anchor" href="#server-function"><i class="fas fa-link"></i></a>
</h2>
<p>接下来，我们将通过在 server 函数中定义输出来使输出变得生动。</p>
<p>Shiny 使用响应式编程使 apps 具有交互性。
您将在 Chapter <a href="basic-reactivity.html#basic-reactivity">3</a> 中了解有关响应式编程的更多信息，但现在请注意，它涉及告诉 Shiny 如何执行计算，而不是命令 Shiny 实际执行计算。
这就像给某人一个菜谱和要求他们给你做一个三明治之间的区别。</p>
<p>我们将通过提供这些输出的“配方”来告诉 Shiny 如何在示例 app 中填写 <code>summary</code> 和 <code>table</code> 输出。
将空的 <code>server</code> 函数替换为：</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span>, <span class="st">"package:datasets"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">renderTable</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span>, <span class="st">"package:datasets"</span><span class="op">)</span></span>
<span>    <span class="va">dataset</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>赋值运算符 (<code>&lt;-</code>) 的左侧，<code>output$ID</code>，表示您正在为具有该 ID 的 Shiny 输出提供配方。
赋值的右侧使用特定的<strong>渲染函数（render function）</strong>来包装您提供的一些代码。
每个 <code>render{Type}</code> 函数都旨在生成特定类型的输出（例如文本、表格和绘图），并且通常与 <code>{type}Output</code> 函数配对。
例如，在此 app 中，<code><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint()</a></code> 与 <code><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput()</a></code> 配合使用，以显示固定宽度（逐字）文本的统计摘要，而 <code><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">renderTable()</a></code> 与 <code><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput()</a></code> 配合使用，以在表格中显示输入数据。</p>
<p>再次运行 app 并进行测试，观察更改输入时输出会发生什么情况。
Figure <a href="basic-app.html#fig:basic-server">1.4</a> 显示了打开 app 时应该看到的内容。</p>
<div class="figure">
<span style="display:block;" id="fig:basic-server"></span>
<img src="demos/basic-app/server.png" alt="现在我们已经提供了连接输出和输入的 server function，我们有了一个功能齐全的 app" width="75%"><p class="caption">
Figure 1.4: 现在我们已经提供了连接输出和输入的 server function，我们有了一个功能齐全的 app
</p>
</div>
<p>请注意，每当您更改输入数据集时，摘要和表格都会更新。
这种依赖关系是隐式创建的，因为我们在输出函数中引用了 <code>input$dataset</code>。
<code>input$dataset</code> 填充了带有 id <code>dataset</code> 的 UI 组件的当前值，并且每当该值发生变化时都会导致输出自动更新。
这是<strong>响应式（reactivity）</strong>的本质：当输入发生变化时，输出会自动做出响应（重新计算）。</p>
</div>
<div id="reactive-expr" class="section level2" number="1.6">
<h2>
<span class="header-section-number">1.6</span> Reducing duplication with reactive expressions<a class="anchor" aria-label="anchor" href="#reactive-expr"><i class="fas fa-link"></i></a>
</h2>
<p>即使在这个简单的示例中，我们也有一些重复的代码：两个输出中都存在以下行。</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span>, <span class="st">"package:datasets"</span><span class="op">)</span></span></code></pre></div>
<p>在每种编程中，重复代码都是不好的做法；它可能会造成计算浪费，更重要的是，它增加了维护或调试代码的难度。
这在这里并不重要，但我想在一个非常简单的上下文中说明基本思想。</p>
<p>不幸的是，这些方法在这里都不起作用，原因您将在 Section <a href="#motivation"><strong>??</strong></a> 中了解，并且我们需要一种新机制：<strong>响应式表达式（reactive expressions）</strong>。</p>
<p>您可以通过将代码块包装在 <code>reactive({...})</code> 中并将其分配给变量来创建响应式表达式，然后通过像函数一样调用它来使用响应式表达式。
但是，虽然看起来像是在调用函数，但响应式表达式有一个重要的区别：它仅在第一次调用时运行，然后缓存其结果，直到需要更新为止。</p>
<p>我们可以更新我们的 <code>server()</code> 以使用响应式表达式，如下所示。
该 app 的行为相同，但工作效率更高一些，因为它只需要检索数据集一次，而不是两次。</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Create a reactive expression</span></span>
<span>  <span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span>, <span class="st">"package:datasets"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># Use a reactive expression by calling it like a function</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">dataset</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">renderTable</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">dataset</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>我们将多次回到响应式编程，但即使具备输入、输出和响应式表达式的粗略知识，也可以构建非常有用的 Shiny apps！</p>
</div>
<div id="summary" class="section level2" number="1.7">
<h2>
<span class="header-section-number">1.7</span> Summary<a class="anchor" aria-label="anchor" href="#summary"><i class="fas fa-link"></i></a>
</h2>
<p>在本章中，您创建了一个简单的 app — 它不是很令人兴奋或有用，但您看到了使用现有的 R 知识构建一个 web app 是多么容易。
在接下来的两章中，您将了解有关用户界面和响应式编程的更多信息，这是 Shiny 的两个基本构建块。
现在是获取 <a href="https://rstudio.github.io/cheatsheets/shiny.pdf">Shiny cheatsheet</a> 的好时机。
这是一个很好的资源，可以帮助您回忆 Shiny app 的主要组件。</p>
<div class="figure">
<span style="display:block;" id="fig:cheatsheet"></span>
<img src="images/basic-app/cheatsheet.png" alt="Shiny cheatsheet, available from https://www.rstudio.com/resources/cheatsheets/" width="352"><p class="caption">
Figure 1.5: Shiny cheatsheet, available from <a href="https://www.rstudio.com/resources/cheatsheets/" class="uri">https://www.rstudio.com/resources/cheatsheets/</a>
</p>
</div>
</div>
<div id="exercises" class="section level2" number="1.8">
<h2>
<span class="header-section-number">1.8</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p>创建一个通过名字向用户打招呼的 app。
您还不知道执行此操作所需的所有函数，因此我在下面添加了一些代码行。
考虑一下您将使用哪些行，然后将它们复制并粘贴到 Shiny app 中的正确位置。</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput</a></span><span class="op">(</span><span class="st">"mortgage"</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">greeting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Hello "</span>, <span class="va">input</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"How old are you?"</span>, value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"What's your name?"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"greeting"</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">histogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, res <span class="op">=</span> <span class="fl">96</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>假设您的朋友想要设计一个 app，允许用户设置 1 到 50 之间的数字 (<code>x</code>)，并显示该数字乘以 5 的结果。
这是他们的第一次尝试：</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"x"</span>, label <span class="op">=</span> <span class="st">"If x is"</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">50</span>, value <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  <span class="st">"then x times 5 is"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"product"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">product</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span> </span>
<span>    <span class="va">x</span> <span class="op">*</span> <span class="fl">5</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>但不幸的是它有一个错误：</p>
<div class="inline-figure"><img src="demos/basic-app/ex-x-times-5.png" width="600"></div>
<p>你能帮助他们找到并纠正错误吗？</p>
</li>
<li>
<p>扩展上一个练习中的 app，以允许用户设置乘数 <code>y</code> 的值，以便应用程序生成 <code>x * y</code> 的值。
最终结果应该是这样的：</p>
<div class="inline-figure"><img src="demos/basic-app/ex-x-times-y.png" width="600"></div>
</li>
<li>
<p>使用以下 app，它为上一个练习中描述的最后一个 app 添加了一些附加功能。
什么是新的？
如何通过使用响应式表达式来减少 app 中重复代码的数量。</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"If x is"</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">50</span>, value <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"and y is"</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">50</span>, value <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"then, (x * y) is"</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"product"</span><span class="op">)</span>,</span>
<span>  <span class="st">"and, (x * y) + 5 is"</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"product_plus5"</span><span class="op">)</span>,</span>
<span>  <span class="st">"and (x * y) + 10 is"</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"product_plus10"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">product</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span> </span>
<span>    <span class="va">product</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">x</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">y</span></span>
<span>    <span class="va">product</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">product_plus5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span> </span>
<span>    <span class="va">product</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">x</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">y</span></span>
<span>    <span class="va">product</span> <span class="op">+</span> <span class="fl">5</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">product_plus10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span> </span>
<span>    <span class="va">product</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">x</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">y</span></span>
<span>    <span class="va">product</span> <span class="op">+</span> <span class="fl">10</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>以下 app 与您在本章前面看到的 app 非常相似：您从包中选择一个数据集（这次我们使用 <strong>ggplot2</strong> 包），然后该 app 打印出数据的摘要和绘图。
它还遵循良好实践并利用响应式表达式来避免代码冗余。
然而，下面提供的代码中存在三个错误。
你能找到并修复它们吗？</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.2.3</span></span>
<span></span>
<span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"economics"</span>, <span class="st">"faithfuld"</span>, <span class="st">"seals"</span><span class="op">)</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span><span class="st">"dataset"</span>, <span class="st">"Dataset"</span>, choices <span class="op">=</span> <span class="va">datasets</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"summary"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span>, <span class="st">"package:ggplot2"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">summmry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">dataset</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, res <span class="op">=</span> <span class="fl">96</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="basic-intro.html">Introduction</a></div>
<div class="next"><a href="basic-ui.html"><span class="header-section-number">2</span> Basic UI</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#basic-app"><span class="header-section-number">1</span> Your first Shiny app</a></li>
<li><a class="nav-link" href="#introduction"><span class="header-section-number">1.1</span> Introduction</a></li>
<li><a class="nav-link" href="#create-app"><span class="header-section-number">1.2</span> Create app directory and file</a></li>
<li><a class="nav-link" href="#running"><span class="header-section-number">1.3</span> Running and stopping</a></li>
<li><a class="nav-link" href="#adding-ui"><span class="header-section-number">1.4</span> Adding UI controls</a></li>
<li><a class="nav-link" href="#server-function"><span class="header-section-number">1.5</span> Adding behaviour</a></li>
<li><a class="nav-link" href="#reactive-expr"><span class="header-section-number">1.6</span> Reducing duplication with reactive expressions</a></li>
<li><a class="nav-link" href="#summary"><span class="header-section-number">1.7</span> Summary</a></li>
<li><a class="nav-link" href="#exercises"><span class="header-section-number">1.8</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/zhenghu159/blogdown-book-zh-cn/blob/master/basic-app.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/zhenghu159/blogdown-book-zh-cn/edit/master/basic-app.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Mastering Shiny</strong>" was written by Hadley Wickham. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
